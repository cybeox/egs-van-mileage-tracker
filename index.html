 
import React, { useState, useEffect } from 'react';
import { Car, User, MapPin, Fuel, Calendar, FileText, Download, Plus, TrendingUp, Clock } from 'lucide-react';

const VanMileageTracker = () => {
  const [drivers, setDrivers] = useState(['Ijaz']);
  const [selectedDriver, setSelectedDriver] = useState('Ijaz');
  const [newDriverName, setNewDriverName] = useState('');
  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
  const [showAddDriver, setShowAddDriver] = useState(false);
  
  // Form data
  const [formData, setFormData] = useState({
    startPoint: '',
    startMileage: '',
    destination: '',
    endPoint: '',
    endMileage: '',
    fuelPrice: ''
  });

  // Mock data for demonstration
  const [records, setRecords] = useState([
    {
      id: 1,
      driver: 'Ijaz',
      date: '2025-08-01',
      startPoint: 'Depot Leeds',
      startMileage: 15420,
      destination: 'Manchester Office',
      endPoint: 'Depot Leeds',
      endMileage: 15498,
      totalMiles: 78,
      fuelPrice: 45.50
    },
    {
      id: 2,
      driver: 'Ijaz',
      date: '2025-07-31',
      startPoint: 'Depot Leeds',
      startMileage: 15342,
      destination: 'Birmingham Warehouse',
      endPoint: 'Depot Leeds',
      endMileage: 15420,
      totalMiles: 78,
      fuelPrice: 52.30
    }
  ]);

  const handleInputChange = (field, value) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const calculateTotalMiles = () => {
    const start = parseFloat(formData.startMileage) || 0;
    const end = parseFloat(formData.endMileage) || 0;
    return end > start ? end - start : 0;
  };

  const addDriver = () => {
    if (newDriverName.trim() && !drivers.includes(newDriverName.trim())) {
      setDrivers([...drivers, newDriverName.trim()]);
      setNewDriverName('');
      setShowAddDriver(false);
    }
  };

  const saveRecord = () => {
    if (formData.startPoint && formData.startMileage && formData.endMileage) {
      const newRecord = {
        id: records.length + 1,
        driver: selectedDriver,
        date: selectedDate,
        ...formData,
        startMileage: parseFloat(formData.startMileage),
        endMileage: parseFloat(formData.endMileage),
        totalMiles: calculateTotalMiles(),
        fuelPrice: parseFloat(formData.fuelPrice) || 0
      };
      setRecords([newRecord, ...records]);
      setFormData({
        startPoint: '',
        startMileage: '',
        destination: '',
        endPoint: '',
        endMileage: '',
        fuelPrice: ''
      });
    }
  };

  // Analytics calculations
  const getAnalytics = () => {
    const today = new Date();
    const thisWeekStart = new Date(today.setDate(today.getDate() - today.getDay()));
    const thisMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);
    const thisYearStart = new Date(today.getFullYear(), 0, 1);

    const analytics = {
      totalMiles: records.reduce((sum, record) => sum + record.totalMiles, 0),
      weeklyMiles: records.filter(r => new Date(r.date) >= thisWeekStart).reduce((sum, record) => sum + record.totalMiles, 0),
      monthlyMiles: records.filter(r => new Date(r.date) >= thisMonthStart).reduce((sum, record) => sum + record.totalMiles, 0),
      yearlyMiles: records.filter(r => new Date(r.date) >= thisYearStart).reduce((sum, record) => sum + record.totalMiles, 0),
      weeklyFuel: records.filter(r => new Date(r.date) >= thisWeekStart).reduce((sum, record) => sum + record.fuelPrice, 0),
      totalFuel: records.reduce((sum, record) => sum + record.fuelPrice, 0)
    };

    return analytics;
  };

  const analytics = getAnalytics();

  const exportData = (format) => {
    // In a real app, this would generate actual Excel/PDF files
    alert(`Exporting data as ${format.toUpperCase()}... (Feature would be implemented with libraries like xlsx or jsPDF)`);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        {/* Header */}
        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <Car className="w-8 h-8" />
              <div>
                <h1 className="text-xl font-bold">Van Tracker</h1>
                <p className="text-blue-100 text-sm">Mileage & Fuel Logger</p>
              </div>
            </div>
            <Calendar className="w-6 h-6" />
          </div>
        </div>

        {/* Driver Selection */}
        <div className="p-6 border-b border-gray-100">
          <div className="flex items-center justify-between mb-4">
            <label className="flex items-center text-gray-700 font-medium">
              <User className="w-4 h-4 mr-2" />
              Driver
            </label>
            <button
              onClick={() => setShowAddDriver(!showAddDriver)}
              className="text-blue-600 hover:text-blue-700"
            >
              <Plus className="w-5 h-5" />
            </button>
          </div>
          
          <select
            value={selectedDriver}
            onChange={(e) => setSelectedDriver(e.target.value)}
            className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            {drivers.map(driver => (
              <option key={driver} value={driver}>{driver}</option>
            ))}
          </select>

          {showAddDriver && (
            <div className="mt-3 flex space-x-2">
              <input
                type="text"
                value={newDriverName}
                onChange={(e) => setNewDriverName(e.target.value)}
                placeholder="New driver name"
                className="flex-1 p-2 border border-gray-200 rounded-lg text-sm"
              />
              <button
                onClick={addDriver}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700"
              >
                Add
              </button>
            </div>
          )}
        </div>

        {/* Date Selection */}
        <div className="p-6 border-b border-gray-100">
          <label className="block text-gray-700 font-medium mb-3">
            <Calendar className="w-4 h-4 inline mr-2" />
            Date
          </label>
          <input
            type="date"
            value={selectedDate}
            onChange={(e) => setSelectedDate(e.target.value)}
            className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>

        {/* Mileage Form */}
        <div className="p-6 space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                <MapPin className="w-4 h-4 inline mr-1" />
                Start Point
              </label>
              <input
                type="text"
                value={formData.startPoint}
                onChange={(e) => handleInputChange('startPoint', e.target.value)}
                placeholder="e.g., Depot Leeds"
                className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
            </div>
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                Start Mileage
              </label>
              <input
                type="number"
                value={formData.startMileage}
                onChange={(e) => handleInputChange('startMileage', e.target.value)}
                placeholder="15420"
                className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
            </div>
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-2 text-sm">
              <MapPin className="w-4 h-4 inline mr-1" />
              Destination
            </label>
            <input
              type="text"
              value={formData.destination}
              onChange={(e) => handleInputChange('destination', e.target.value)}
              placeholder="e.g., Manchester Office"
              className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
            />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                End Point
              </label>
              <input
                type="text"
                value={formData.endPoint}
                onChange={(e) => handleInputChange('endPoint', e.target.value)}
                placeholder="e.g., Depot Leeds"
                className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
            </div>
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                End Mileage
              </label>
              <input
                type="number"
                value={formData.endMileage}
                onChange={(e) => handleInputChange('endMileage', e.target.value)}
                placeholder="15498"
                className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                <Fuel className="w-4 h-4 inline mr-1" />
                Fuel Price (£)
              </label>
              <input
                type="number"
                step="0.01"
                value={formData.fuelPrice}
                onChange={(e) => handleInputChange('fuelPrice', e.target.value)}
                placeholder="45.50"
                className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
            </div>
            <div>
              <label className="block text-gray-700 font-medium mb-2 text-sm">
                Total Miles
              </label>
              <div className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
                {calculateTotalMiles()} miles
              </div>
            </div>
          </div>

          <button
            onClick={saveRecord}
            className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg"
          >
            Save Record
          </button>
        </div>

        {/* Analytics Dashboard */}
        <div className="p-6 bg-gray-50 border-t border-gray-100">
          <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <TrendingUp className="w-5 h-5 mr-2" />
            Analytics
          </h3>
          
          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="bg-white p-4 rounded-lg shadow-sm">
              <div className="text-xs text-gray-500 uppercase tracking-wide">Weekly Miles</div>
              <div className="text-xl font-bold text-blue-600">{analytics.weeklyMiles}</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow-sm">
              <div className="text-xs text-gray-500 uppercase tracking-wide">Monthly Miles</div>
              <div className="text-xl font-bold text-green-600">{analytics.monthlyMiles}</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow-sm">
              <div className="text-xs text-gray-500 uppercase tracking-wide">Weekly Fuel</div>
              <div className="text-xl font-bold text-purple-600">£{analytics.weeklyFuel.toFixed(2)}</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow-sm">
              <div className="text-xs text-gray-500 uppercase tracking-wide">Total Miles</div>
              <div className="text-xl font-bold text-orange-600">{analytics.totalMiles}</div>
            </div>
          </div>

          {/* Export Buttons */}
          <div className="flex space-x-2">
            <button
              onClick={() => exportData('excel')}
              className="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-green-700 flex items-center justify-center"
            >
              <Download className="w-4 h-4 mr-1" />
              Excel
            </button>
            <button
              onClick={() => exportData('pdf')}
              className="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-red-700 flex items-center justify-center"
            >
              <FileText className="w-4 h-4 mr-1" />
              PDF
            </button>
          </div>
        </div>

        {/* Recent Records */}
        <div className="p-6">
          <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <Clock className="w-5 h-5 mr-2" />
            Recent Records
          </h3>
          
          <div className="space-y-3 max-h-64 overflow-y-auto">
            {records.map(record => (
              <div key={record.id} className="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                <div className="flex justify-between items-start mb-2">
                  <div className="text-sm font-medium text-gray-800">{record.driver}</div>
                  <div className="text-xs text-gray-500">{record.date}</div>
                </div>
                <div className="text-sm text-gray-600 mb-1">
                  {record.startPoint} → {record.destination}
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-blue-600 font-medium">{record.totalMiles} miles</span>
                  <span className="text-green-600 font-medium">£{record.fuelPrice.toFixed(2)}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default VanMileageTracker;
